<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyBlog</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="backvanta"></div>
  <nav>
    <div class="logo">MyBlog</div>

    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/profile">Profile</a>
      <a href="/blogs">Blogs</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
    </div>

    <div class="auth-btns">
      <a href="/login">Login</a>
      <a href="/signup">Signup</a>
      <div class="logout">Logout</div>
    </div>
  </nav>

  <h1 class="heading">Welcome to Blog Community</h1>
  <p class="subheading">A platform where you can create, share, and explore blogs with likes and comments.</p>

  <div class="container">

    <!-- CARD 1 -->
    <div class="card">
      <div class="card-header">
        <img src="Amrit.jpeg" alt="Person">
        <strong>John Doe</strong>
      </div>
      <h2>Title of Blog</h2>
      <div class="blog-content">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vel odio nec mi tempor dignissim.
      </div>
      <div class="actions">
        <button>Like ‚ù§Ô∏è</button>
        <button>Comment üí¨</button>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <script>
      var setVanta = () => {
        if (window.VANTA) window.VANTA.NET({
          el: ".s-page-1 .s-section-1 .s-section",
          mouseControls: true,
          touchControls: true,
          gyroControls: false,
          minHeight: 200.00,
          minWidth: 200.00,
          scale: 1.00,
          scaleMobile: 1.00,
          color: 0xb67100,
          backgroundColor: 0x0
        })
      }
      _strk.push(function () {
        setVanta()
        window.edit_page.Event.subscribe("Page.beforeNewOneFadeIn", setVanta)
      })
    </script>
    <script src="three.r134.min.js"></script>
    <script src="vanta.net.min.js"></script>
    <script>
      VANTA.NET({
        el: ".backvanta",
        mouseControls: true,
        touchControls: true,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        scale: 1.00,
        scaleMobile: 1.00,
        color: 0xb67100,
        backgroundColor: 0x0
      })
    </script>
    <script>
      const getdetails = async () => {
        try {
          let response = await fetch("/me", {
            method: "POSt",
            credentials: "include"
          })
          let data = await response.json()
          console.log(data)
          if (data.msg === "loggedIn") {
            document.querySelector(".email").innerHTML = data.email
          }
        } catch (err) {
          console.log(err)
        }
        return data.msg

      }
      userState = getdetails()

      document.querySelector(".logout").addEventListener("click", async () => {
        if (userState === "NotloggedIn") {
          alert("User Not Logged In")
        } else {
          let response = await fetch("/logout", {
            method: "POST",
            credentials: "include"
          })
          let data = await response.json()
          alert(data.msg)
          window.location.reload()
        }
      })

      function createBlogCard(imageSrc, email, title, blogText) {
        // Create card container
        const card = document.createElement("div");
        card.className = "card";

        // Header
        const header = document.createElement("div");
        header.className = "card-header";

        const img = document.createElement("img");
        img.src = imageSrc;
        img.alt = email;

        const name = document.createElement("strong");
        name.textContent = email;

        header.appendChild(img);
        header.appendChild(name);

        //title
        const blogtitle = document.createElement("h2")
        blogtitle.textContent = title

        // Blog content
        const blogContent = document.createElement("div");
        blogContent.className = "blog-content";
        blogContent.textContent = blogText;

        // Actions
        const actions = document.createElement("div");
        actions.className = "actions";

        const likeBtn = document.createElement("button");
        likeBtn.textContent = "Like ‚ù§Ô∏è";

        const commentBtn = document.createElement("button");
        commentBtn.textContent = "Comment üí¨";

        actions.appendChild(likeBtn);
        actions.appendChild(commentBtn);

        // Add all to card
        card.appendChild(header);
        card.appendChild(blogtitle)
        card.appendChild(blogContent);
        card.appendChild(actions);

        return card;
      }

      const getblogs = async () => {
        let response = await fetch("/getblogs", {
          method: "POST",
        })
        let data = await response.json()
        console.log(data.blogs)
        for (let i = 0; i <= data.blogs.length; i++) {
          let email = (data.blogs[i]).email
          let title = (data.blogs[i]).title
          let content = (data.blogs[i]).content
          let card = createBlogCard("Amrit.jpeg", email, title, content)
          document.querySelector(".container").appendChild(card)

        }
      }

      getblogs()
    </script>
</body>

</html>